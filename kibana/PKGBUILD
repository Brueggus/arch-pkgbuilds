# $Id: PKGBUILD 267095 2017-11-17 15:02:03Z mtorromeo $
# Maintainer: Massimiliano Torromeo <massimiliano.torromeo@gmail.com>
# Maintainer: Levente Polyak <anthraxx[at]archlinux[dot]org>
# Contributor: Spider.007 <archlinux AT spider007 DOT net>

pkgname=kibana
pkgver=6.0.0
pkgrel=1
pkgdesc='Browser based analytics and search dashboard for Elasticsearch'
url='https://www.elastic.co/products/kibana'
arch=('any')
license=('Apache')
depends=('nodejs')
optdepends=('elasticsearch')
backup=('etc/kibana/kibana.yml')
options=('!strip' 'emptydirs')
source=(https://artifacts.elastic.co/downloads/${pkgname}/${pkgname}-${pkgver}-linux-x86_64.tar.gz
        kibana.service
        tmpfile.conf
        user.conf)
sha256sums=('52c582846cd814639cd5888ff6ad20c81d7319a673784935bc579cdcfb04680f'
            '34fe64b2f7d27b359b3e2c395f1a30ce48ec2b7116cc974b58345e8928bd843a'
            '2a495d4688af59a3f675517aff49a11a07baf346e7de73a35605cef30faf3ff7'
            '036b00956f3640f80b7e9604ae66ddbeb6ee9eb29bcb171d8e09a4679fd317ef')

prepare() {
  cd ${pkgbase}-${pkgver}-linux-x86_64
  # set default quiet mode for systemd, cli option forces specified values
  sed -r 's|#(logging.quiet:) false|\1 true|' -i config/kibana.yml
}

package() {
  cd ${pkgbase}-${pkgver}-linux-x86_64

  install -dm 755 "${pkgdir}/usr/share/kibana"
  cp -a * "${pkgdir}/usr/share/kibana"

  install -dm 750 "${pkgdir}/etc/kibana"
  install -Dm 640 config/kibana.yml -t "${pkgdir}/etc/kibana"
  install -Dm 644 "${srcdir}/kibana.service" -t "${pkgdir}/usr/lib/systemd/system"

  rm -r "${pkgdir}/usr/share/kibana/node"
}

# vim: ts=2 sw=2 et:
