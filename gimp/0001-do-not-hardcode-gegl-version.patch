From f6a8d93190e2e00006295ed1c1a7c34b770989d6 Mon Sep 17 00:00:00 2001
From: Jehan <jehan@girinstud.io>
Date: Sat, 28 Apr 2018 01:30:19 +0200
Subject: [PATCH] configure, gimp.pc: do no hardcode the major.minor version of
 GEGL.

---
 configure.ac | 10 +++++++---
 gimp.pc.in   |  2 +-
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/configure.ac b/configure.ac
index 07faa44..f017e34 100644
--- a/configure.ac
+++ b/configure.ac
@@ -44,7 +44,10 @@ m4_define([gimp_full_name], [GNU Image Manipulation Program])
 
 # required versions of other packages
 m4_define([babl_required_version], [0.1.46])
-m4_define([gegl_required_version], [0.4.0])
+m4_define([gegl_major_minor_version], [0.4])
+m4_define([gegl_micro_version], [0])
+m4_define([gegl_required_version],
+          [gegl_major_minor_version.gegl_micro_version])
 m4_define([glib_required_version], [2.54.2])
 m4_define([atk_required_version], [2.2.0])
 m4_define([gtk_required_version], [2.24.10])
@@ -141,6 +144,7 @@ GTK_REQUIRED_VERSION=gtk_required_version
 GTK_WIN32_RECOMMENDED_VERSION=gtk_win32_recommended_version
 CAIRO_REQUIRED_VERSION=cairo_required_version
 CAIRO_PDF_REQUIRED_VERSION=cairo_pdf_required_version
+GEGL_MAJOR_MINOR_VERSION=gegl_major_minor_version
 GEGL_REQUIRED_VERSION=gegl_required_version
 GEXIV2_REQUIRED_VERSION=gexiv2_required_version
 LCMS_REQUIRED_VERSION=lcms_required_version
@@ -671,8 +675,8 @@ m4_define([add_deps_error], [
 
 PKG_CHECK_MODULES(BABL, [babl >= babl_required_version],,
                   [add_deps_error([babl >= babl_required_version])])
-PKG_CHECK_MODULES(GEGL, gegl-0.4 >= gegl_required_version,,
-                  [add_deps_error([gegl-0.4 >= gegl_required_version])])
+PKG_CHECK_MODULES(GEGL, gegl-gegl_major_minor_version >= gegl_required_version,,
+                  [add_deps_error([gegl-gegl_major_minor_version >= gegl_required_version])])
 PKG_CHECK_MODULES(ATK, atk >= atk_required_version,,
                   [add_deps_error([atk >= atk_required_version])])
 
diff --git a/gimp.pc.in b/gimp.pc.in
index 9cf1da9..2e8d78c 100644
--- a/gimp.pc.in
+++ b/gimp.pc.in
@@ -12,6 +12,6 @@ gimplocaledir=@gimplocaledir@
 Name: GIMP
 Description: GIMP Library
 Version: @GIMP_REAL_VERSION@
-Requires: gdk-pixbuf-2.0 >= @GDK_PIXBUF_REQUIRED_VERSION@ cairo >= @CAIRO_REQUIRED_VERSION@ gegl-0.3 >= @GEGL_REQUIRED_VERSION@
+Requires: gdk-pixbuf-2.0 >= @GDK_PIXBUF_REQUIRED_VERSION@ cairo >= @CAIRO_REQUIRED_VERSION@ gegl-@GEGL_MAJOR_MINOR_VERSION@ >= @GEGL_REQUIRED_VERSION@
 Libs: -L${libdir} -lgimp-@GIMP_API_VERSION@ -lgimpmath-@GIMP_API_VERSION@  -lgimpconfig-@GIMP_API_VERSION@ -lgimpcolor-@GIMP_API_VERSION@ -lgimpbase-@GIMP_API_VERSION@ @RT_LIBS@
 Cflags: -I${includedir}/gimp-@GIMP_API_VERSION@
